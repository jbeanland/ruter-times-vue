(function(t){function e(e){for(var n,i,o=e[0],u=e[1],l=e[2],h=0,d=[];h<o.length;h++)i=o[h],r[i]&&d.push(r[i][0]),r[i]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(t[n]=u[n]);c&&c(e);while(d.length)d.shift()();return a.push.apply(a,l||[]),s()}function s(){for(var t,e=0;e<a.length;e++){for(var s=a[e],n=!0,o=1;o<s.length;o++){var u=s[o];0!==r[u]&&(n=!1)}n&&(a.splice(e--,1),t=i(i.s=s[0]))}return t}var n={},r={app:0},a=[];function i(e){if(n[e])return n[e].exports;var s=n[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=n,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var c=u;a.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"034f":function(t,e,s){"use strict";var n=s("c21b"),r=s.n(n);r.a},"2da0":function(t,e,s){},4410:function(t,e,s){},"56d7":function(t,e,s){"use strict";s.r(e);s("7f7f"),s("cadf"),s("551c"),s("097d");var n=s("2b0e"),r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("router-view")],1)},a=[],i=(s("034f"),s("2877")),o={},u=Object(i["a"])(o,r,a,!1,null,null,null);u.options.__file="App.vue";var l=u.exports,c=s("8c4f"),h=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"home"}},[s("nav",{staticClass:"navbar",attrs:{role:"navigation","aria-label":"main navigation"}},[s("div",{staticClass:"fill-space absolute"},[s("div",{staticClass:"navbar-brand fill-space absolute"},[s("div",{staticClass:"navbar-item"},[s("font-awesome-icon",{staticClass:"red",attrs:{icon:"hashtag",size:"2x"}})],1),s("div",{staticClass:"fill-space"},[s("div",{staticClass:"navbar-item fill-space ",attrs:{id:"main-field"}},[s("div",{staticClass:"field has-addons fill-space"},[s("p",{staticClass:"control is-pulled-right fill-space"},[t._v('\'setInput\') :items="stops" @result="changeStop" :placeholder="placeholder"/>\n                      ')]),s("p",{staticClass:"control "},[s("button",{staticClass:"button is-black nav-button",on:{click:t.refresh}},[s("font-awesome-icon",{staticClass:"green",attrs:{icon:"sync-alt",size:"lg"}})],1)]),s("p",{staticClass:"control "},[t.currentIsFavourite?s("button",{staticClass:"button is-black nav-button white",on:{click:t.removeFavourite}},[s("font-awesome-icon",{staticClass:"red",attrs:{icon:"heart",size:"lg"}})],1):s("button",{staticClass:"button is-black white nav-button",on:{click:t.setFavourite}},[s("font-awesome-icon",{staticClass:"white",attrs:{icon:["far","heart"],size:"lg"}})],1)]),s("p",{staticClass:"control "},[s("b-dropdown",{attrs:{hoverable:"",position:"is-bottom-left"}},[s("button",{staticClass:"button is-black nav-button",attrs:{slot:"trigger",id:"dropdown-button"},slot:"trigger"},[s("span",[s("font-awesome-icon",{staticClass:"white",attrs:{icon:"caret-down",size:"lg"}})],1)]),t._l(t.favourites,function(e,n){return s("b-dropdown-item",{key:n,on:{click:function(s){t.changeStop(e)}}},[t._v(t._s(e.label))])})],2)],1)])])])])])]),s("p",{staticClass:"white"},[t._v(" "+t._s(t.input))]),t.errorMessage.length>0?s("div",{attrs:{id:"message-container"}},[s("article",{staticClass:"message",attrs:{id:"error-message"}},[s("div",{staticClass:"message-body",attrs:{id:"error-message-body"}},[t._v("\n              "+t._s(t.errorMessage)+"\n          ")])])]):t._e(),s("div",{staticClass:"container main-container"},[s("div",{staticClass:"columns is-multiline"},[t._l(t.departureTimes,function(t,e){return s("timetable",{key:e,attrs:{data:t}})}),s("div",{staticClass:"column"},[s("article",{staticClass:"message is-small"},[t._m(0),s("div",{staticClass:"message-body"},[t._v("\n                      "+t._s(t.timeSinceUpdate)+"\n                  ")])])])],2)]),s("footer",{staticClass:"footer"},[s("div",{staticClass:"content has-text-centered"},[s("p",[s("span",{staticClass:"text-muted"},[t._v("By Jack Beanland, 2018.\n                  "),s("a",{attrs:{href:"https://github.com/jbeanland/ruter-times-vue",id:"github-link"}},[s("font-awesome-icon",{staticClass:"white",attrs:{icon:["fab","github"]}})],1)])])])])])},d=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"message-header"},[s("p",[t._v("Last Updated:")])])}],p=(s("55dd"),s("20d6"),s("7514"),s("ac6a"),s("4f7f"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"column"},[s("div",{staticClass:"card rounded shadow main-card"},[s("div",{staticClass:"card-header"},[s("p",{staticClass:"card-header-title",staticStyle:{"text-align":"center"}},[t._v("\n                Platform "+t._s(t.data.platform)+"\n            ")])]),s("div",{staticClass:"card-content"},[s("div",{staticClass:"card"},[s("table",{staticClass:"table is-fullwidth"},[t._m(0),s("tbody",t._l(t.data.results,function(e,n){return s("tr",{key:n},[s("td",[t._v(t._s(e.MonitoredVehicleJourney.PublishedLineName))]),s("td",[t._v(t._s(e.MonitoredVehicleJourney.DestinationName))]),s("td",[t._v(t._s(t.timeToDeparture(e.minsAway)))])])}))])])])])])}),f=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",{staticClass:"thead"},[s("tr",[s("th",[t._v("Line")]),s("th",[t._v("Destination")]),s("th",[t._v("Time")])])])}],v={props:{data:Object},methods:{timeToDeparture:function(t){return t>1?t+" minutes":1==t?"1 minute":"now"}}},m=v,g=(s("8f591"),Object(i["a"])(m,p,f,!1,null,"36e25770",null));g.options.__file="Timetable.vue";var w=g.exports,b=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"autocomplete control"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.search,expression:"search"}],staticClass:"input is-expanded",attrs:{type:"text",placeholder:t.placeholder},domProps:{value:t.search},on:{input:[function(e){e.target.composing||(t.search=e.target.value)},t.onChange],keydown:[function(e){return"button"in e||!t._k(e.keyCode,"down",40,e.key,["Down","ArrowDown"])?t.onArrowDown(e):null},function(e){return"button"in e||!t._k(e.keyCode,"up",38,e.key,["Up","ArrowUp"])?t.onArrowUp(e):null}],keyup:[function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.onEnter(e):null},function(e){return"button"in e||!t._k(e.keyCode,"escape",void 0,e.key,void 0)?t.onEscape(e):null}]}}),s("ul",{directives:[{name:"show",rawName:"v-show",value:t.isOpen&&t.results.length>0,expression:"isOpen && (results.length > 0)"}],staticClass:"autocomplete-results"},[t.isLoading?s("li",{staticClass:"loading"},[t._v("Loading Results...\n        ")]):t._l(t.results,function(e,n){return s("li",{key:n,staticClass:"autocomplete-result",class:{"is-active":n===t.arrowCounter},on:{click:function(s){t.setResult(e)}}},[t._v("\n            "+t._s(e.label)+"\n        ")])})],2)])},C=[],y=(s("386d"),s("c5f6"),{name:"autocomplete",props:{items:{type:Array,required:!1,default:function(){return[]}},isAsync:{type:Boolean,required:!1,default:!1},minLength:{type:Number,required:!1,default:3},placeholder:{type:String,required:!1,default:""}},data:function(){return{search:"",results:[],isOpen:!1,isLoading:!1,arrowCounter:-1,accentMap:{"ø":"o","Ø":"o","æ":"ae","Æ":"ae","å":"a","Å":"a"}}},watch:{items:function(t){this.isAsync&&(this.results=t,this.isOpen=!0,this.isLoading=!1)}},methods:{onChange:function(){this.search.length>=this.minLength?(this.$emit("input",this.search),this.isAsync?this.isLoading=!0:(this.filterResults(),this.isOpen=!0),this.arrowCounter=-1,this.isOpen=!0,this.filterResults()):(this.isOpen=!1,this.arrowCounter=-1)},filterResults:function(){var t=this;this.results=this.items.filter(function(e){return t.normalise(e.label).indexOf(t.normalise(t.search))>-1})},setResult:function(t){this.search="",this.isOpen=!1,this.arrowCounter=-1,this.results=[],this.$emit("result",t)},onEnter:function(){var t=this.results[this.arrowCounter];this.setResult(t)},onArrowDown:function(){this.arrowCounter<this.results.length-1&&(this.arrowCounter=this.arrowCounter+1),this.isOpen||(this.isOpen=!0)},onArrowUp:function(){this.arrowCounter>0&&(this.arrowCounter=this.arrowCounter-1)},onEscape:function(){this.isOpen=!1,this.arrowCounter=-1},handleClickOutside:function(t){this.$el.contains(t.target)||(this.isOpen=!1,this.arrowCounter=-1)},normalise:function(t){for(var e="",s=0;s<t.length;s++)e+=this.accentMap[t.charAt(s)]||t.charAt(s);return e.toLowerCase()}},mounted:function(){document.addEventListener("click",this.handleClickOutside)},destroyed:function(){document.removeEventListener("click",this.handleClickOutside)}}),_=y,k=(s("e2d5"),Object(i["a"])(_,b,C,!1,null,null,null));k.options.__file="Autocomplete.vue";var O=k.exports,S=s("bc3a"),M=s.n(S),I={data:function(){return{stops:[],favourites:[],lastUpdated:null,transportTypes:new Set([2,8]),departureTimes:[],currentStop:null,currentIsFavourite:!1,currentDate:Date.now(),placeholder:"Stop...",errorMessage:"",input:""}},components:{Timetable:w,Autocomplete:O},watch:{$route:function(){var t=this.$route.params.value;t?this.update(t):(window.document.title="Ruter times",this.lastUpdated=null,this.currentStop=null,this.currentIsFavourite=!1,this.errorMessage="",this.placeholder="Stop...",this.departureTimes=[])}},mounted:function(){var t=localStorage.getItem("stops");t?this.stops=JSON.parse(t):this.getStops();var e=JSON.parse(localStorage.getItem("fav"));null!=e&&(this.favourites=e),this.interval=setInterval(this.setCurrentTime,1e3);var s=this.$route.params.value;s&&this.update(s)},destroyed:function(){clearInterval(this.interval)},methods:{setInput:function(t){this.input=t},update:function(t){this.errorMessage=this.errorMessage+"in update start\n";var e=this.stops.find(function(e){return e.value==t});this.errorMessage=this.errorMessage+"in update start"+e.value+" "+e.label+"\n",e?(window.document.title="Ruter - "+e.label,this.errorMessage=this.errorMessage+"in Update end\n",this.getTimes(e)):this.errorMessage=this.errorMessage+"Oops, looks like that stop ID doesn't exist, or at least I don't have it. Try searching instead.\n"},setCurrentTime:function(){this.currentDate=Date.now()},getStops:function(){var t=this;M.a.get("https://reisapi.ruter.no/Line/GetLinesRuterExtended?ruterOperatedOnly=true").then(function(e){for(var s=e.data.filter(function(e){return t.transportTypes.has(e["Transportation"])}),n=new Set,r=[],a=0;a<s.length;a++)for(var i=s[a].Stops,o=0;o<i.length;o++){var u=i[o];n.has(u.Id)||(r.push({value:u.Id,label:u.Name}),n.add(u.Id))}t.stops=r,localStorage.setItem("stops",JSON.stringify(r))}).catch(function(){t.errorMessage="Looks like something went wrong while fetching the data from Ruter. Try again in a moment or check your connection"})},changeStop:function(t){this.$router.push({name:"stop",params:{value:t.value}})},refresh:function(){null!=this.currentStop&&this.getTimes(this.currentStop)},getTimes:function(t){var e=this;console.log("getTimes: ",t.value,t.label),this.errorMessage=this.errorMessage+"in getTimes\n",this.currentStop=t,this.placeholder=t.label,this.currentFavouriteIndex>=0?this.currentIsFavourite=!0:this.currentIsFavourite=!1,this.setCurrentTime(),this.lastUpdated=Date.now();var s="https://reisapi.ruter.no/StopVisit/GetDepartures/"+t.value;console.log("path",s),M.a.get(s).then(function(t){console.log("response received"),e.errorMessage=e.errorMessage+"got response\n",e.formatData(t.data)}).catch(function(){e.errorMessage="Looks like something went wrong while fetching the data from Ruter. Try again in a moment or check your connection"})},formatData:function(t){for(var e=[],s=0;s<t.length;s++){var n=t[s],r=new Date(n.MonitoredVehicleJourney.MonitoredCall.ExpectedDepartureTime),a=Math.floor((r-this.currentDate)/1e3/60);if(a<=30){n.minsAway=a;var i=n.MonitoredVehicleJourney.MonitoredCall.DeparturePlatformName,o=e.findIndex(function(t){return t.platform===i});o>=0?e[o].results.push(n):e.push({platform:i,results:[n]})}}for(var u=0;u<e.length;u++)e[u].results.sort(function(t,e){return parseFloat(t.minsAway)-parseFloat(e.minsAway)});e.sort(function(t,e){return t.platform.localeCompare(e.platform)}),this.departureTimes=e},setFavourite:function(){-1==this.currentFavouriteIndex&&(this.favourites.push(this.currentStop),this.currentIsFavourite=!0,localStorage.setItem("fav",JSON.stringify(this.favourites)))},removeFavourite:function(){this.currentFavouriteIndex>=0&&(this.favourites.splice(this.currentFavouriteIndex,this.currentFavouriteIndex+1),this.currentIsFavourite=!1,localStorage.setItem("fav",JSON.stringify(this.favourites)))}},computed:{currentFavouriteIndex:function(){var t=this;return null!=this.currentStop?this.favourites.findIndex(function(e){return e.value==t.currentStop.value}):-1},timeSinceUpdate:function(){if(null==this.lastUpdated)return"never updated";var t=Math.floor((this.currentDate-this.lastUpdated)/1e3),e=0;return e=Math.floor(t/86400),e>=1?e+" days  ago":(e=Math.floor(t/3600),e>=1?e+" hours  ago":(e=Math.floor(t/60),e>=1?e+" minutes  ago":t+" seconds ago"))}}},x=I,T=(s("cccb"),Object(i["a"])(x,h,d,!1,null,null,null));T.options.__file="Home.vue";var D=T.exports;n["a"].use(c["a"]);var A=new c["a"]({mode:"history",base:"/",routes:[{path:"/:value",name:"stop",component:D},{path:"/",name:"home",component:D}]}),F=s("3fa7"),L=s.n(F),E=s("ecee"),j=s("c074"),$=s("b702"),U=s("f2d1"),J=s("7a55");s("8e0a"),s("92c6");n["a"].component(L.a.Dropdown.name,L.a.Dropdown),n["a"].component(L.a.DropdownItem.name,L.a.DropdownItem),n["a"].component(L.a.Autocomplete.name,L.a.Autocomplete),E["library"].add(U["a"],j["d"],j["c"],$["a"],j["a"],j["b"]),n["a"].component("font-awesome-icon",J["FontAwesomeIcon"]),n["a"].config.productionTip=!1,new n["a"]({router:A,render:function(t){return t(l)}}).$mount("#app")},"8f59":function(t,e,s){},"8f591":function(t,e,s){"use strict";var n=s("4410"),r=s.n(n);r.a},c21b:function(t,e,s){},cccb:function(t,e,s){"use strict";var n=s("8f59"),r=s.n(n);r.a},e2d5:function(t,e,s){"use strict";var n=s("2da0"),r=s.n(n);r.a}});
//# sourceMappingURL=app.983660bb.js.map