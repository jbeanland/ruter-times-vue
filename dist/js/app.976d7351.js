(function(t){function e(e){for(var r,i,o=e[0],u=e[1],l=e[2],d=0,h=[];d<o.length;d++)i=o[d],s[i]&&h.push(s[i][0]),s[i]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);c&&c(e);while(h.length)h.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],r=!0,o=1;o<n.length;o++){var u=n[o];0!==s[u]&&(r=!1)}r&&(a.splice(e--,1),t=i(i.s=n[0]))}return t}var r={},s={app:0},a=[];function i(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=r,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var c=u;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var r=n("c21b"),s=n.n(r);s.a},"2da0":function(t,e,n){},4410:function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("7f7f"),n("cadf"),n("551c"),n("097d");var r=n("2b0e"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},a=[],i=(n("034f"),n("2877")),o={},u=Object(i["a"])(o,s,a,!1,null,null,null);u.options.__file="App.vue";var l=u.exports,c=n("8c4f"),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"home"}},[n("nav",{staticClass:"navbar",attrs:{role:"navigation","aria-label":"main navigation"}},[n("div",{staticClass:"fill-space absolute"},[n("div",{staticClass:"navbar-brand fill-space absolute"},[n("div",{staticClass:"navbar-item"},[n("font-awesome-icon",{staticClass:"red",attrs:{icon:"hashtag",size:"2x"}})],1),n("div",{staticClass:"fill-space"},[n("div",{staticClass:"navbar-item fill-space ",attrs:{id:"main-field"}},[n("div",{staticClass:"field has-addons fill-space"},[n("p",{staticClass:"control is-pulled-right fill-space"},[n("autocomplete",{attrs:{id:"input",items:t.stops,placeholder:t.placeholder},on:{result:t.changeStop}})],1),n("p",{staticClass:"control "},[n("button",{staticClass:"button is-black nav-button",on:{click:t.refresh}},[n("font-awesome-icon",{staticClass:"green",attrs:{icon:"sync-alt",size:"lg"}})],1)]),n("p",{staticClass:"control "},[t.currentIsFavourite?n("button",{staticClass:"button is-black nav-button white",on:{click:t.removeFavourite}},[n("font-awesome-icon",{staticClass:"red",attrs:{icon:"heart",size:"lg"}})],1):n("button",{staticClass:"button is-black white nav-button",on:{click:t.setFavourite}},[n("font-awesome-icon",{staticClass:"white",attrs:{icon:["far","heart"],size:"lg"}})],1)]),n("p",{staticClass:"control "},[n("b-dropdown",{attrs:{hoverable:"",position:"is-bottom-left"}},[n("button",{staticClass:"button is-black nav-button",attrs:{slot:"trigger",id:"dropdown-button"},slot:"trigger"},[n("span",[n("font-awesome-icon",{staticClass:"white",attrs:{icon:"caret-down",size:"lg"}})],1)]),t._l(t.favourites,function(e,r){return n("b-dropdown-item",{key:r,on:{click:function(n){t.changeStop(e)}}},[t._v(t._s(e.label))])})],2)],1)])])])])])]),t.errorMessage.length>0?n("div",{attrs:{id:"message-container"}},[n("article",{staticClass:"message",attrs:{id:"error-message"}},[n("div",{staticClass:"message-body",attrs:{id:"error-message-body"}},[t._v("\n              "+t._s(t.errorMessage)+"\n          ")])])]):t._e(),n("div",{staticClass:"container main-container"},[n("div",{staticClass:"columns is-multiline"},[t._l(t.departureTimes,function(t,e){return n("timetable",{key:e,attrs:{data:t}})}),n("div",{staticClass:"column"},[n("article",{staticClass:"message is-small"},[t._m(0),n("div",{staticClass:"message-body"},[t._v("\n                      "+t._s(t.timeSinceUpdate)+"\n                  ")])])])],2)]),n("footer",{staticClass:"footer"},[n("div",{staticClass:"content has-text-centered"},[n("p",[n("span",{staticClass:"text-muted"},[t._v("By Jack Beanland, 2018.\n                  "),n("a",{attrs:{href:"https://github.com/jbeanland/ruter-times-vue",id:"github-link"}},[n("font-awesome-icon",{staticClass:"white",attrs:{icon:["fab","github"]}})],1)])])])])])},h=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"message-header"},[n("p",[t._v("Last Updated:")])])}],p=(n("55dd"),n("20d6"),n("7514"),n("ac6a"),n("4f7f"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"column"},[n("div",{staticClass:"card rounded shadow main-card"},[n("div",{staticClass:"card-header"},[n("p",{staticClass:"card-header-title",staticStyle:{"text-align":"center"}},[t._v("\n                Platform "+t._s(t.data.platform)+"\n            ")])]),n("div",{staticClass:"card-content"},[n("div",{staticClass:"card"},[n("table",{staticClass:"table is-fullwidth"},[t._m(0),n("tbody",t._l(t.data.results,function(e,r){return n("tr",{key:r},[n("td",[t._v(t._s(e.MonitoredVehicleJourney.PublishedLineName))]),n("td",[t._v(t._s(e.MonitoredVehicleJourney.DestinationName))]),n("td",[t._v(t._s(t.timeToDeparture(e.minsAway)))])])}))])])])])])}),f=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("thead",{staticClass:"thead"},[n("tr",[n("th",[t._v("Line")]),n("th",[t._v("Destination")]),n("th",[t._v("Time")])])])}],m={props:{data:Object},methods:{timeToDeparture:function(t){return t>1?t+" minutes":1==t?"1 minute":"now"}}},v=m,g=(n("8f591"),Object(i["a"])(v,p,f,!1,null,"36e25770",null));g.options.__file="Timetable.vue";var w=g.exports,b=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"autocomplete control"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.search,expression:"search"}],staticClass:"input is-expanded",attrs:{type:"text",placeholder:t.placeholder},domProps:{value:t.search},on:{input:[function(e){e.target.composing||(t.search=e.target.value)},t.onChange],keydown:[function(e){return"button"in e||!t._k(e.keyCode,"down",40,e.key,["Down","ArrowDown"])?t.onArrowDown(e):null},function(e){return"button"in e||!t._k(e.keyCode,"up",38,e.key,["Up","ArrowUp"])?t.onArrowUp(e):null}],keyup:[function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.onEnter(e):null},function(e){return"button"in e||!t._k(e.keyCode,"escape",void 0,e.key,void 0)?t.onEscape(e):null}]}}),n("ul",{directives:[{name:"show",rawName:"v-show",value:t.isOpen&&t.results.length>0,expression:"isOpen && (results.length > 0)"}],staticClass:"autocomplete-results"},[t.isLoading?n("li",{staticClass:"loading"},[t._v("Loading Results...\n        ")]):t._l(t.results,function(e,r){return n("li",{key:r,staticClass:"autocomplete-result",class:{"is-active":r===t.arrowCounter},on:{click:function(n){t.setResult(e)}}},[t._v("\n            "+t._s(e.label)+"\n        ")])})],2)])},C=[],y=(n("386d"),n("c5f6"),{name:"autocomplete",props:{items:{type:Array,required:!1,default:function(){return[]}},isAsync:{type:Boolean,required:!1,default:!1},minLength:{type:Number,required:!1,default:3},placeholder:{type:String,required:!1,default:""}},data:function(){return{search:"",results:[],isOpen:!1,isLoading:!1,arrowCounter:-1,accentMap:{"ø":"o","Ø":"o","æ":"ae","Æ":"ae","å":"a","Å":"a"}}},watch:{items:function(t){this.isAsync&&(this.results=t,this.isOpen=!0,this.isLoading=!1)}},methods:{onChange:function(){this.search.length>=this.minLength?(this.$emit("input",this.search),this.isAsync?this.isLoading=!0:(this.filterResults(),this.isOpen=!0),this.arrowCounter=-1,this.isOpen=!0,this.filterResults()):(this.isOpen=!1,this.arrowCounter=-1)},filterResults:function(){var t=this;this.results=this.items.filter(function(e){return t.normalise(e.label).indexOf(t.normalise(t.search))>-1})},setResult:function(t){this.search="",this.isOpen=!1,this.arrowCounter=-1,this.results=[],this.$emit("result",t)},onEnter:function(){var t=this.results[this.arrowCounter];this.setResult(t)},onArrowDown:function(){this.arrowCounter<this.results.length-1&&(this.arrowCounter=this.arrowCounter+1),this.isOpen||(this.isOpen=!0)},onArrowUp:function(){this.arrowCounter>0&&(this.arrowCounter=this.arrowCounter-1)},onEscape:function(){this.isOpen=!1,this.arrowCounter=-1},handleClickOutside:function(t){this.$el.contains(t.target)||(this.isOpen=!1,this.arrowCounter=-1)},normalise:function(t){for(var e="",n=0;n<t.length;n++)e+=this.accentMap[t.charAt(n)]||t.charAt(n);return e.toLowerCase()}},mounted:function(){document.addEventListener("click",this.handleClickOutside)},destroyed:function(){document.removeEventListener("click",this.handleClickOutside)}}),_=y,k=(n("e2d5"),Object(i["a"])(_,b,C,!1,null,null,null));k.options.__file="Autocomplete.vue";var O=k.exports,S=n("bc3a"),x=n.n(S),I={data:function(){return{stops:[],favourites:[],lastUpdated:null,transportTypes:new Set([2,8]),departureTimes:[],currentStop:null,currentIsFavourite:!1,currentDate:Date.now(),placeholder:"Stop...",errorMessage:""}},components:{Timetable:w,Autocomplete:O},watch:{$route:function(){var t=this.$route.params.value;t?this.update(t):(window.document.title="Ruter times",this.lastUpdated=null,this.currentStop=null,this.currentIsFavourite=!1,this.errorMessage="",this.placeholder="Stop...",this.departureTimes=[])}},mounted:function(){var t=localStorage.getItem("stops");t?this.stops=JSON.parse(t):this.getStops();var e=JSON.parse(localStorage.getItem("fav"));null!=e&&(this.favourites=e),this.interval=setInterval(this.setCurrentTime,1e3);var n=this.$route.params.value;n&&this.update(n)},destroyed:function(){clearInterval(this.interval)},methods:{update:function(t){var e=this.stops.find(function(e){return e.value==t});e?(window.document.title="Ruter - "+e.label,this.getTimes(e)):this.errorMessage="Oops, looks like that stop ID doesn't exist, or at least I don't have it. Try searching instead."},setCurrentTime:function(){this.currentDate=Date.now()},getStops:function(){var t=this;x.a.get("https://reisapi.ruter.no/Line/GetLinesRuterExtended?ruterOperatedOnly=true").then(function(e){for(var n=e.data.filter(function(e){return t.transportTypes.has(e["Transportation"])}),r=new Set,s=[],a=0;a<n.length;a++)for(var i=n[a].Stops,o=0;o<i.length;o++){var u=i[o];r.has(u.Id)||(s.push({value:u.Id,label:u.Name}),r.add(u.Id))}t.stops=s,localStorage.setItem("stops",JSON.stringify(s))}).catch(function(){t.errorMessage="Looks like something went wrong while fetching the data from Ruter. Try again in a moment or check your connection"})},changeStop:function(t){this.$router.push({name:"stop",params:{value:t.value}})},refresh:function(){null!=this.currentStop&&this.getTimes(this.currentStop)},getTimes:function(t){var e=this;this.errorMessage="",this.currentStop=t,this.placeholder=t.label,this.currentFavouriteIndex>=0?this.currentIsFavourite=!0:this.currentIsFavourite=!1,this.setCurrentTime(),this.lastUpdated=Date.now();var n="https://reisapi.ruter.no/StopVisit/GetDepartures/"+t.value;x.a.get(n).then(function(t){e.formatData(t.data)}).catch(function(){e.errorMessage="Looks like something went wrong while fetching the data from Ruter. Try again in a moment or check your connection"})},formatData:function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n],s=new Date(r.MonitoredVehicleJourney.MonitoredCall.ExpectedDepartureTime),a=Math.floor((s-this.currentDate)/1e3/60);if(a<=30){r.minsAway=a;var i=r.MonitoredVehicleJourney.MonitoredCall.DeparturePlatformName,o=e.findIndex(function(t){return t.platform===i});o>=0?e[o].results.push(r):e.push({platform:i,results:[r]})}}for(var u=0;u<e.length;u++)e[u].results.sort(function(t,e){return parseFloat(t.minsAway)-parseFloat(e.minsAway)});e.sort(function(t,e){return t.platform.localeCompare(e.platform)}),this.departureTimes=e},setFavourite:function(){-1==this.currentFavouriteIndex&&(this.favourites.push(this.currentStop),this.currentIsFavourite=!0,localStorage.setItem("fav",JSON.stringify(this.favourites)))},removeFavourite:function(){this.currentFavouriteIndex>=0&&(this.favourites.splice(this.currentFavouriteIndex,this.currentFavouriteIndex+1),this.currentIsFavourite=!1,localStorage.setItem("fav",JSON.stringify(this.favourites)))}},computed:{currentFavouriteIndex:function(){var t=this;return null!=this.currentStop?this.favourites.findIndex(function(e){return e.value==t.currentStop.value}):-1},timeSinceUpdate:function(){if(null==this.lastUpdated)return"never updated";var t=Math.floor((this.currentDate-this.lastUpdated)/1e3),e=0;return e=Math.floor(t/86400),e>=1?e+" days  ago":(e=Math.floor(t/3600),e>=1?e+" hours  ago":(e=Math.floor(t/60),e>=1?e+" minutes  ago":t+" seconds ago"))}}},D=I,M=(n("cccb"),Object(i["a"])(D,d,h,!1,null,null,null));M.options.__file="Home.vue";var T=M.exports;r["a"].use(c["a"]);var A=new c["a"]({mode:"history",base:"/",routes:[{path:"/:value",name:"stop",component:T},{path:"/",name:"home",component:T}]}),F=n("3fa7"),L=n.n(F),E=n("ecee"),j=n("c074"),$=n("b702"),J=n("f2d1"),N=n("7a55");n("8e0a"),n("92c6");r["a"].component(L.a.Dropdown.name,L.a.Dropdown),r["a"].component(L.a.DropdownItem.name,L.a.DropdownItem),r["a"].component(L.a.Autocomplete.name,L.a.Autocomplete),E["library"].add(J["a"],j["d"],j["c"],$["a"],j["a"],j["b"]),r["a"].component("font-awesome-icon",N["FontAwesomeIcon"]),r["a"].config.productionTip=!1,new r["a"]({router:A,render:function(t){return t(l)}}).$mount("#app")},"8f59":function(t,e,n){},"8f591":function(t,e,n){"use strict";var r=n("4410"),s=n.n(r);s.a},c21b:function(t,e,n){},cccb:function(t,e,n){"use strict";var r=n("8f59"),s=n.n(r);s.a},e2d5:function(t,e,n){"use strict";var r=n("2da0"),s=n.n(r);s.a}});
//# sourceMappingURL=app.976d7351.js.map