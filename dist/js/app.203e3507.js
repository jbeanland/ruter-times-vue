(function(t){function e(e){for(var n,s,i=e[0],c=e[1],u=e[2],d=0,f=[];d<i.length;d++)s=i[d],r[s]&&f.push(r[s][0]),r[s]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);l&&l(e);while(f.length)f.shift()();return o.push.apply(o,u||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],n=!0,i=1;i<a.length;i++){var c=a[i];0!==r[c]&&(n=!1)}n&&(o.splice(e--,1),t=s(s.s=a[0]))}return t}var n={},r={app:0},o=[];function s(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=n,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(a,n,function(e){return t[e]}.bind(null,n));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=e,i=i.slice();for(var u=0;u<i.length;u++)e(i[u]);var l=c;o.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";var n=a("c21b"),r=a.n(n);r.a},"307f":function(t,e,a){"use strict";var n=a("c341"),r=a.n(n);r.a},4410:function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);a("7f7f"),a("cadf"),a("551c"),a("097d");var n=a("2b0e"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},o=[],s=(a("034f"),a("2877")),i={},c=Object(s["a"])(i,r,o,!1,null,null,null);c.options.__file="App.vue";var u=c.exports,l=a("8c4f"),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"home"}},[a("navbar-main",{attrs:{stops:t.stops,currentStop:t.currentStop,favourites:t.favourites,placeholder:t.placeholder,currentIsFavourite:t.currentIsFavourite,isLoading:t.isLoading},on:{refresh:t.refresh,"change-stop":t.changeStop,"remove-favourite":t.removeFavourite,"set-favourite":t.setFavourite}}),t.errorMessage.length>0?a("div",{attrs:{id:"message-container"}},[a("article",{staticClass:"message",attrs:{id:"error-message"}},[a("div",{staticClass:"message-body",attrs:{id:"error-message-body"}},[t._v("\n                "+t._s(t.errorMessage)+"\n            ")])])]):t._e(),a("div",{staticClass:"container main-container"},[a("div",{staticClass:"columns is-multiline"},[t._l(t.departureTimes,function(t,e){return a("timetable",{key:e,attrs:{data:t}})}),a("div",{staticClass:"column"},[a("article",{staticClass:"message is-small"},[t._m(0),a("div",{staticClass:"message-body"},[t._v("\n                        "+t._s(t.timeSinceUpdate)+"\n                    ")])])])],2)]),a("footer-main")],1)},f=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"message-header"},[a("p",[t._v("Last Updated:")])])}],p=(a("55dd"),a("20d6"),a("7514"),a("ac6a"),a("4f7f"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"column"},[a("div",{staticClass:"card rounded shadow main-card"},[a("div",{staticClass:"card-header"},[a("p",{staticClass:"card-header-title",staticStyle:{"text-align":"center"}},[t._v("\n                Platform "+t._s(t.data.platform)+"\n            ")])]),a("div",{staticClass:"card-content"},[a("div",{staticClass:"card"},[a("table",{staticClass:"table is-fullwidth"},[t._m(0),a("tbody",t._l(t.data.results,function(e,n){return a("tr",{key:n},[a("td",[t._v(t._s(e.MonitoredVehicleJourney.PublishedLineName))]),a("td",[t._v(t._s(e.MonitoredVehicleJourney.DestinationName))]),a("td",[t._v(t._s(t.timeToDeparture(e.minsAway)))])])}))])])])])])}),h=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",{staticClass:"thead"},[a("tr",[a("th",[t._v("Line")]),a("th",[t._v("Destination")]),a("th",[t._v("Time")])])])}],v={props:{data:Object},methods:{timeToDeparture:function(t){return t>1?t+" minutes":1==t?"1 minute":"now"}}},m=v,g=(a("8f591"),Object(s["a"])(m,p,h,!1,null,"36e25770",null));g.options.__file="Timetable.vue";var b=g.exports,w=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("footer",{staticClass:"footer"},[a("div",{staticClass:"content has-text-centered"},[a("p",[a("span",{staticClass:"text-muted"},[t._v("By Jack Beanland, 2018.\n                "),a("a",{attrs:{href:"https://github.com/jbeanland/ruter-times-vue",id:"github-link"}},[a("font-awesome-icon",{staticClass:"white",attrs:{icon:["fab","github"]}})],1)])])])])},y=[],_=(a("307f"),{}),S=Object(s["a"])(_,w,y,!1,null,"74ca4adc",null);S.options.__file="FooterMain.vue";var C=S.exports,x=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("nav",{staticClass:"navbar",attrs:{role:"navigation","aria-label":"main navigation"}},[a("div",{staticClass:"fill-space absolute"},[a("div",{staticClass:"navbar-brand fill-space absolute"},[a("div",{staticClass:"navbar-item"},[a("font-awesome-icon",{staticClass:"red",attrs:{icon:"hashtag",size:"2x"}})],1),a("div",{staticClass:"fill-space"},[a("div",{staticClass:"navbar-item fill-space ",attrs:{id:"main-field"}},[a("div",{staticClass:"field has-addons fill-space"},[a("p",{staticClass:"control is-pulled-right fill-space"},[a("b-autocomplete",{attrs:{id:"input",placeholder:t.placeholder,"clear-on-select":!0,data:t.filteredData,field:"label"},on:{select:t.changeStop},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),a("p",{staticClass:"control "},[a("button",{staticClass:"button is-black nav-button",attrs:{id:"refresh-button"},on:{click:function(e){t.$emit("refresh")}}},[a("font-awesome-icon",{staticClass:"green",attrs:{icon:"sync-alt",size:"lg",spin:t.isLoading}})],1)]),a("p",{staticClass:"control "},[t.currentIsFavourite?a("button",{staticClass:"button is-black nav-button white",on:{click:function(e){t.$emit("remove-favourite")}}},[a("font-awesome-icon",{staticClass:"red",attrs:{icon:"heart",size:"lg"}})],1):a("button",{staticClass:"button is-black white nav-button",on:{click:function(e){t.$emit("set-favourite")}}},[a("font-awesome-icon",{staticClass:"white",attrs:{icon:["far","heart"],size:"lg"}})],1)]),a("p",{staticClass:"control "},[a("b-dropdown",{attrs:{"mobile-modal":!1,position:"is-bottom-left"}},[a("button",{staticClass:"button is-black nav-button",attrs:{slot:"trigger",id:"dropdown-button"},slot:"trigger"},[a("span",[a("font-awesome-icon",{staticClass:"white",attrs:{icon:"caret-down",size:"lg"}})],1)]),t._l(t.favourites,function(e,n){return a("b-dropdown-item",{key:n,on:{click:function(a){t.changeStop(e)}}},[t._v(t._s(e.label))])})],2)],1)])])])])])])},I=[],M=(a("386d"),{name:"main-navbar",props:{stops:{type:Array,default:function(){return[]}},favourites:{type:Array,default:function(){return[]}},currentStop:{type:Object,default:function(){}},placeholder:{type:String,default:"Stop..."},currentIsFavourite:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},data:function(){return{search:"",accentMap:{"ø":"o","Ø":"o","æ":"ae","Æ":"ae","å":"a","Å":"a"}}},methods:{normalise:function(t){for(var e="",a=0;a<t.length;a++)e+=this.accentMap[t.charAt(a)]||t.charAt(a);return e.toLowerCase()},changeStop:function(t){this.$emit("change-stop",t)}},computed:{filteredData:function(){var t=this;return this.search.length<3?[]:this.stops.filter(function(e){return t.normalise(e.label).indexOf(t.normalise(t.search))>-1})}}}),k=M,O=(a("b403"),Object(s["a"])(k,x,I,!1,null,"57cae4d9",null));O.options.__file="NavbarMain.vue";var D=O.exports,T=a("bc3a"),F=a.n(T),j={name:"main-view",data:function(){return{stops:[],favourites:[],lastUpdated:null,transportTypes:new Set([2,8]),departureTimes:[],currentStop:null,currentDate:Date.now(),placeholder:"Stop...",errorMessage:"",isLoading:!1}},components:{Timetable:b,FooterMain:C,NavbarMain:D},watch:{$route:function(){var t=this.$route.params.value;t?this.update(t):(window.document.title="Ruter times",this.lastUpdated=null,this.currentStop=null,this.errorMessage="",this.placeholder="Stop...",this.departureTimes=[])}},mounted:function(){var t=this;this.getStops();var e=JSON.parse(localStorage.getItem("fav"));null!=e&&(this.favourites=e),this.interval=setInterval(function(){t.currentDate=Date.now()},1e3);var a=this.$route.params.value;a&&this.update(a)},destroyed:function(){clearInterval(this.interval)},methods:{getStops:function(){var t=localStorage.getItem("stops");t?this.stops=JSON.parse(t):this.getStopsFresh()},getStopsFresh:function(){var t=this;F.a.get("https://reisapi.ruter.no/Line/GetLinesRuterExtended?ruterOperatedOnly=true").then(function(e){for(var a=e.data.filter(function(e){return t.transportTypes.has(e["Transportation"])}),n=new Set,r=[],o=0;o<a.length;o++)for(var s=a[o].Stops,i=0;i<s.length;i++){var c=s[i];n.has(c.Id)||(r.push({value:c.Id,label:c.Name}),n.add(c.Id))}t.stops=r,localStorage.setItem("stops",JSON.stringify(r))}).catch(function(){t.errorMessage="Looks like something went wrong while fetching the data from Ruter. Try again in a moment or check your connection"})},changeStop:function(t){t&&this.$router.push({name:"stop",params:{value:t.value}})},update:function(t){var e=this.stops.find(function(e){return e.value==t});e?(window.document.title="Ruter - "+e.label,this.getTimes(e)):this.errorMessage="Oops, looks like that stop ID doesn't exist, or at least I don't have it. Try searching instead."},refresh:function(){null!=this.currentStop&&this.getTimes(this.currentStop)},getTimes:function(t){var e=this;this.currentStop=t,this.placeholder=t.label,this.isLoading=!0;var a="https://reisapi.ruter.no/StopVisit/GetDepartures/"+t.value;F.a.get(a).then(function(t){e.formatTimes(t.data)}).catch(function(){e.errorMessage="Looks like something went wrong while fetching the data from Ruter. Try again in a moment or check your connection"}).then(function(){e.isLoading=!1,e.currentDate=Date.now(),e.lastUpdated=Date.now()})},formatTimes:function(t){for(var e=[],a=0;a<t.length;a++){var n=t[a],r=new Date(n.MonitoredVehicleJourney.MonitoredCall.ExpectedDepartureTime),o=Math.floor((r-this.currentDate)/1e3/60);if(o<=30){n.minsAway=o;var s=n.MonitoredVehicleJourney.MonitoredCall.DeparturePlatformName,i=e.findIndex(function(t){return t.platform===s});i>=0?e[i].results.push(n):e.push({platform:s,results:[n]})}}for(var c=0;c<e.length;c++)e[c].results.sort(function(t,e){return parseFloat(t.minsAway)-parseFloat(e.minsAway)});e.sort(function(t,e){return t.platform.localeCompare(e.platform)}),this.departureTimes=e},setFavourite:function(){-1==this.currentFavouriteIndex&&(this.favourites.push(this.currentStop),localStorage.setItem("fav",JSON.stringify(this.favourites)))},removeFavourite:function(){this.currentFavouriteIndex>=0&&(this.favourites.splice(this.currentFavouriteIndex,this.currentFavouriteIndex+1),localStorage.setItem("fav",JSON.stringify(this.favourites)))}},computed:{currentFavouriteIndex:function(){var t=this;return null!=this.currentStop?this.favourites.findIndex(function(e){return e.value==t.currentStop.value}):-1},currentIsFavourite:function(){return this.currentFavouriteIndex>=0},timeSinceUpdate:function(){if(null==this.lastUpdated)return"never updated";var t=Math.floor((this.currentDate-this.lastUpdated)/1e3),e=0;return e=Math.floor(t/86400),e>=1?1==e?"Yesterday":e+" days  ago":(e=Math.floor(t/3600),e>=1?1==e?"1 hour ago":e+" hours  ago":(e=Math.floor(t/60),e>=1?1==e?"1 minute ago":e+" minutes  ago":t+" seconds ago"))}}},$=j,L=(a("cccb"),Object(s["a"])($,d,f,!1,null,null,null));L.options.__file="Home.vue";var A=L.exports;n["a"].use(l["a"]);var J=new l["a"]({mode:"history",base:"/",routes:[{path:"/:value",name:"stop",component:A},{path:"/",name:"home",component:A}]}),N=a("3fa7"),E=a.n(N),P=a("ecee"),U=a("c074"),z=a("b702"),R=a("f2d1"),V=a("7a55");a("8e0a");n["a"].component(E.a.Dropdown.name,E.a.Dropdown),n["a"].component(E.a.DropdownItem.name,E.a.DropdownItem),n["a"].component(E.a.Autocomplete.name,E.a.Autocomplete),P["library"].add(R["a"],U["d"],U["c"],z["a"],U["a"],U["b"]),n["a"].component("font-awesome-icon",V["FontAwesomeIcon"]),n["a"].config.productionTip=!1,new n["a"]({router:J,render:function(t){return t(u)}}).$mount("#app")},"8f59":function(t,e,a){},"8f591":function(t,e,a){"use strict";var n=a("4410"),r=a.n(n);r.a},b403:function(t,e,a){"use strict";var n=a("d70d"),r=a.n(n);r.a},c21b:function(t,e,a){},c341:function(t,e,a){},cccb:function(t,e,a){"use strict";var n=a("8f59"),r=a.n(n);r.a},d70d:function(t,e,a){}});
//# sourceMappingURL=app.203e3507.js.map